<!DOCTYPE html>
<html lang="en">
<head>

<script>
// Recommendation weights: loaded from backend or localStorage fallback
let WEIGHTS = JSON.parse(localStorage.getItem('recommendationWeights')) || {
    language: 20,
    scale: 30,
    timeSignature: 25,
    taal: 15,
    tempo: 5,
    genre: 5
};

async function fetchRecommendationWeights() {
    try {
        const res = await fetch(`${API_BASE_URL}/api/recommendation-weights`);
        if (res.ok) {
            const data = await res.json();
            WEIGHTS = data;
            localStorage.setItem('recommendationWeights', JSON.stringify(data));
        }
    } catch (e) { /* fallback to local */ }
}

async function saveRecommendationWeightsToBackend(weights) {
    try {
        const res = await fetch(`${API_BASE_URL}/api/recommendation-weights`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('jwtToken') || ''}`
            },
            body: JSON.stringify(weights)
        });
        if (res.ok) {
            const data = await res.json();
            localStorage.setItem('recommendationWeights', JSON.stringify(weights));
            WEIGHTS = weights;
            return { success: true, message: data.message || 'Weights updated' };
        } else {
            const err = await res.json();
            return { success: false, message: err.error || 'Failed to update weights' };
        }
    } catch (e) {
        return { success: false, message: 'Network error' };
    }
}
</script>
    <!-- Auth0 script removed: now using local JWT auth -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New & Old Songs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link rel="stylesheet" href="styles.css">
        <script>
        // Theme toggle logic (used by sidebar button)
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }
        </script>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal" id="loginModal" style="display:none;">
        <div class="modal-content auth-modal-content">
            <span class="close-modal" id="closeLoginModal" aria-label="Close">×</span>
            <h2 style="text-align:center;margin-bottom:18px;">Login</h2>
            <form id="loginForm" class="auth-form">
                <label for="loginUsername">Username</label>
                <input type="text" id="loginUsername" required autocomplete="username">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required autocomplete="current-password">
                <button type="submit" class="btn btn-primary" style="width:100%;margin-top:10px;">Login</button>
                <div id="loginError" style="color:#c31010;margin-top:10px;display:none;"></div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal" style="display:none;">
        <div class="modal-content auth-modal-content">
            <span class="close-modal" id="closeRegisterModal" aria-label="Close">×</span>
            <h2 style="text-align:center;margin-bottom:18px;">Register</h2>
            <form id="registerForm" class="auth-form">
                <label for="registerFirstName">First Name</label>
                <input type="text" id="registerFirstName" required autocomplete="given-name">
                <label for="registerLastName">Last Name</label>
                <input type="text" id="registerLastName" required autocomplete="family-name">
                <label for="registerUsername">Username</label>
                <input type="text" id="registerUsername" required autocomplete="username">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required autocomplete="email">
                <label for="registerPhone">Phone Number</label>
                <input type="tel" id="registerPhone" required autocomplete="tel">
                <label for="registerPassword">Password</label>
                <input type="password" id="registerPassword" required autocomplete="new-password">
                <button type="submit" class="btn btn-primary" style="width:100%;margin-top:10px;">Register</button>
                <div id="registerError" style="color:#c31010;margin-top:10px;display:none;"></div>
            </form>
        </div>
    </div>
    <!-- Loading spinner removed -->
    <div class="app-container">
        <button class="panel-toggle draggable" id="toggle-sidebar"><i class="fas fa-home"></i></button>
        <button class="panel-toggle draggable" id="toggle-songs"><i class="fas fa-list"></i></button>
        <button class="panel-toggle draggable" id="toggle-all-panels"><i class="fas fa-eye-slash"></i></button>

        <!-- Auto-scroll controls -->
        <div class="auto-scroll-controls">
            <button class="auto-scroll-btn" id="toggleAutoScroll" title="Auto Scroll"><i class="fas fa-play"></i></button>
        </div>

        <!-- Keep screen on button -->
        <!-- <button class="keep-screen-on" id="keepScreenOnBtn" title="Keep Screen On"><i class="fa fa-sign-language"></i></button> -->

        <!-- Notification -->
        <div class="notification" id="notification"></div>

        <!-- Sidebar -->
        <div class="sidebar hidden">
            <div class="sidebar-header">
                <h2>New & Old</h2>
            </div>
            <ul class="sidebar-menu">
                <button id="loginBtn" class="sidebar-btn btn-login"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button id="registerBtn" class="sidebar-btn btn-login"><i class="fas fa-user-plus"></i> Register</button>
                <div id="userGreeting" style="display:none;font-weight:bold;margin-bottom:8px;"></div>
                <button id="logoutBtn" class="sidebar-btn btn-login" style="display:none;"><i class="fas fa-sign-out-alt"></i> Logout</button>
                <button id="adminPanelBtn" class="sidebar-btn" style="display:none;"><i class="fas fa-cogs"></i> Admin Panel</button>

            <div id="adminPanelModal" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="document.getElementById('adminPanelModal').style.display='none'">&times;</span>
                    <h2>Admin Panel</h2>
                    <div class="admin-tabs">
                        <button class="admin-tab active" id="userMgmtTab">User Management</button>
                        <button class="admin-tab" id="weightsTab">Recommendation Weights</button>
                        <button class="admin-tab" id="duplicateDetectionTab">Duplicate Detection</button>
                    </div>
                    <div class="admin-tab-content" id="userMgmtTabContent">
                        <div class="notification" id="adminNotification"></div>
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Admin</th>
                                    <th>Action</th>
                                    <th>Password Reset</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="admin-tab-content" id="weightsTabContent" style="display:none;">
                        <div class="notification" id="weightsNotification"></div>
                        <form id="weightsForm" style="max-width: 420px; margin: 0 auto;">
                            <table id="weightsTable" style="width:100%; border-collapse:collapse; background:#fff; margin-bottom:16px;">
                            <div id="weightsTotalBar" style="margin: 10px 0 8px 0; text-align:center; font-weight:600; font-size:1.08em;"></div>
                                <thead>
                                    <tr style="background:#f6f8fa; color:#3498db; font-weight:600;">
                                        <th style="padding:10px 8px; text-align:left;">Parameter</th>
                                        <th style="padding:10px 8px; text-align:left;">Weight</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding:10px 8px;">Language</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightLanguage" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Scale</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightScale" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Time Signature</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightTimeSignature" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Taal</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightTaal" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Tempo</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightTempo" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Genre</td>
                                           <td style="padding:10px 8px;"><input type="number" id="weightGenre" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Vocal</td>
                                        <td style="padding:10px 8px;"><input type="number" id="weightVocal" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">Mood</td>
                                        <td style="padding:10px 8px;"><input type="number" id="weightMood" min="0" max="100" step="5" required style="width:60px;"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button type="submit" class="btn" style="width:100%;margin-top:8px;">Save Weights</button>
                        </form>
                        <div style="text-align:center; color:#888; font-size:0.98em; margin-top:4px;">Total should be 100 for best results.</div>
                    </div>
                    <div class="admin-tab-content" id="duplicateDetectionTabContent" style="display:none;">
                        <!-- Duplicate detection results will be rendered by JS -->
                    </div>
                </div>
            </div>
                <li><a href="#" class="active" id="showAll">All Songs</a></li>
                <li>
                    <div class="setlist-selector">
                        <div class="custom-setlist-dropdown" id="customSetlistDropdown">
                            <div class="dropdown-main-area" id="dropdownMainArea">
                                <span class="dropdown-text" id="dropdownText">Select a Setlist</span>
                            </div>
                            <div class="dropdown-arrow" id="dropdownArrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <select id="setlistDropdown" style="display: none;">
                                <option value="">Select a Setlist</option>
                            </select>
                            <div class="dropdown-menu" id="dropdownMenu" style="display: none;">
                                <!-- Options will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </li>   
                
                <!-- Setlist Description Display -->
                <div class="setlist-description-container" id="setlistDescriptionContainer" style="display: none;">
                    <div class="setlist-description-content">
                        <div class="setlist-description-text" id="setlistDescriptionText"></div>
                    </div>
                </div>
                
                <li><a href="#" id="showFavorites">Favorites</a></li>
                <li><button id="addSongBelowFavoritesBtn" class="sidebar-btn" style="width:100%;margin-top:10px;"><i class="fa fa-plus"></i> Add New Song</button></li>

                <!-- Global Setlists Section -->
                <li style="margin-top:15px;">
                    <div class="setlist-folder">
                        <div class="folder-header" id="globalSetlistHeader">
                            <i class="fas fa-chevron-right folder-icon" id="globalSetlistIcon"></i>
                            <i class="fas fa-globe"></i>
                            <span>Global Setlists</span>
                            <button id="addGlobalSetlistBtn" class="add-setlist-btn" style="display:none;" title="Add Global Setlist">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <ul class="setlist-folder-content" id="globalSetlistContent" style="display:none;">
                            <!-- Global setlists will be populated here -->
                        </ul>
                        
                        <!-- Global Setlist Description -->
                        <div class="setlist-description-container" id="globalSetlistDescriptionContainer" style="display: none;">
                            <div class="setlist-description-content">
                                <div class="setlist-description-text" id="globalSetlistDescriptionText"></div>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- My Setlists Section -->
                <li>
                    <div class="setlist-folder">
                        <div class="folder-header" id="mySetlistHeader">
                            <i class="fas fa-chevron-right folder-icon" id="mySetlistIcon"></i>
                            <i class="fas fa-user"></i>
                            <span>My Setlists</span>
                            <button id="addMySetlistBtn" class="add-setlist-btn" style="display:none;" title="Add My Setlist">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <ul class="setlist-folder-content" id="mySetlistContent" style="display:none;">
                            <!-- My setlists will be populated here -->
                        </ul>
                        
                        <!-- My Setlist Description -->
                        <div class="setlist-description-container" id="mySetlistDescriptionContainer" style="display: none;">
                            <div class="setlist-description-content">
                                <div class="setlist-description-text" id="mySetlistDescriptionText"></div>
                            </div>
                        </div>
                    </div>
                </li>

            </ul>
            </ul>
            <div class="sidebar-footer">
                <div class="sidebar-footer">
                    <div class="song-count">
                        <div>Total Songs: <span id="totalSongs">0</span></div>
                        <div>New: <span id="NewCount">0</span></div>
                        <div>Old: <span id="OldCount">0</span></div>
                    </div>

                    <button class="theme-toggle" id="themeToggle" style="width:100%;margin-top:10px;">
                        <i class="fas fa-moon"></i>
                        <span>Dark Mode</span>
                    </button>

                    <button class="sidebar-btn" id="downloadHtmlWithSongsBtn" style="display:none;">
                        <i class="fas fa-file-export"></i> Download HTML with Songs
                    </button>
                </div>
                <div class="sidebar-folder" style="display:none;">
                    <div class="folder-toggle" id="toggleSongTools">
                        <i class="fas fa-folder-open"></i> Song Tools
                        <i class="fas fa-caret-down folder-caret"></i>
                    </div>
                    <div class="folder-content" id="songToolsContent">
                        <button class="sidebar-btn" id="openAddSongModal">
                            <i class="fa fa-plus"></i> Add New Song
                        </button>
                        <button class="sidebar-btn" id="downloadSongsBtn">
                            <i class="fas fa-download"></i> Download Songs
                        </button>
                        <button class="sidebar-btn btn-delete" id="deleteAllSongsBtn">
                            <i class="fas fa-trash-alt"></i> Delete All Songs
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Songs Panel -->
        <div class="songs-section hidden">
            <div class="sticky-header">
                <div class="tabs">
                    <div class="setlist-tab active" id="NewTab">New</div>
                    <div class="setlist-tab" id="OldTab">Old</div>
                </div>
                <div class="filters-row">
                    <div class="search-container">
                        <input type="text" id="searchInput" class="compact-input" placeholder="Search songs..."
                               style="padding-right: 30px;" autocomplete="off">
                        <span id="clearSearch" class="clear-search-btn" style="display: none;">×</span>
                        <div id="searchHistoryDropdown" class="search-history-dropdown"></div>
                    </div>
                    <div class="filter-row-1" style="display:flex; gap:8px; align-items:center; margin-top:6px;">
                        <select id="keyFilter" class="compact-select">
  <!-- Options will be populated by JS -->
                        </select>
                        <select id="genreFilter" class="compact-select">
  <!-- Options will be populated by JS -->
                        </select>
                        <select id="moodFilter" class="compact-select">
  <!-- Options will be populated by JS -->
                        </select>
                        <select id="artistFilter" class="compact-select">
  <!-- Options will be populated by JS -->
                        </select>
                    </div>
                    <div class="filter-row-2" style="margin-top:6px;">
                        <select id="sortFilter" class="compact-select">
                            <option value="recent">Recently Added</option>
                            <option value="az">A-Z</option>
                            <option value="za">Z-A</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                    </div>
                </div>

                <div class="search-results" id="searchResults">
                    <div class="search-results-header">Search Results</div>
                    <div id="searchResultsContent" class="scrollable-results"></div>
                </div>
            </div>
            <div class="tab-content active" id="NewContent"></div>
            <div class="tab-content" id="OldContent"></div>
            <div class="setlist" id="setlistSection" style="display: none;">
                <h3 id="setlistViewHeader">Setlist View</h3>
                <div class="setlist-tabs">
                    <div class="setlist-tab active" id="NewSetlistTab">New</div>
                    <div class="setlist-tab" id="OldSetlistTab">Old</div>
                </div>
                <div class="setlist-content">
                    <div id="NewSetlistSongs"></div>
                    <div id="OldSetlistSongs" style="display: none;"></div>
                </div>
            </div>
            <div class="delete-section" id="deleteSection" style="display: none;">
                <h3>Delete Songs</h3>
                <div id="deleteContent"></div>
            </div>
            <div class="favorites-section" id="favoritesSection" style="display: none;">
                <h3>Favorite Songs</h3>
                <div id="favoritesContent"></div>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section" id="songPreview">
            <h2>Select a song</h2>
            <div class="song-lyrics">No song is selected</div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Add New Song</h3>
            <form id="newSongForm" class="add-song-form">
                <label for="songTitle">Title:</label>
                <input type="text" id="songTitle" required>
                <label for="songCategory">Category:</label>
                <select id="songCategory" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="songKey">Key:</label>
                <select id="songKey" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="songArtist">Artist Details:</label>
                <div class="multiselect-container">
                    <input type="text" id="songArtist" class="compact-input" placeholder="Search and select artists..." readonly>
                    <div class="multiselect-dropdown" id="artistDropdown">
                        <!-- Artist options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="selectedArtists"></div>
                </div>
                <label for="songMood">Mood:</label>
                <div class="multiselect-container">
                    <input type="text" id="songMood" class="compact-input" placeholder="Search and select moods..." readonly>
                    <div class="multiselect-dropdown" id="moodDropdown">
                        <!-- Mood options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="selectedMoods"></div>
                </div>
                <label for="songTempo">Tempo (BPM):</label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input type="text" id="songTempo" placeholder="e.g., 80 BPM" >
                    <button type="button" id="tapTempoBtn" class="tap-tempo-btn">Tap Tempo</button>
                </div>
                <label for="songTime">Time Signature:</label>
                <select id="songTime" >
  <!-- Options will be populated by JS -->
                </select>
                <label for="songTaal">Taal:</label>
                <select id="songTaal" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="songGenre">Genre:</label>
                <div class="multiselect-container">
                    <input type="text" id="songGenre" class="compact-input" placeholder="Search genres...">
                    <div class="multiselect-dropdown" id="genreDropdown">
                        <!-- Genre options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="selectedGenres"></div>
                </div>
                <label for="songLyrics">Lyrics:</label>
                <textarea id="songLyrics" required></textarea>
                <button type="submit" class="btn btn-primary">Add Song</button>
            </form>
        </div>
    </div>

    <div class="modal" id="editSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Edit Song</h3>
            <form id="editSongForm" class="edit-song-form">
                <input type="hidden" id="editSongId">
                <label for="editSongTitle">Title:</label>
                <input type="text" id="editSongTitle" required>
                <label for="editSongCategory">Category:</label>
                <select id="editSongCategory" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="editSongKey">Key:</label>
                <select id="editSongKey" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="editSongArtist">Artist Details:</label>
                <div class="multiselect-container">
                    <input type="text" id="editSongArtist" class="compact-input" placeholder="Search and select artists..." readonly>
                    <div class="multiselect-dropdown" id="editArtistDropdown">
                        <!-- Artist options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="editSelectedArtists"></div>
                </div>
                <label for="editSongMood">Mood:</label>
                <div class="multiselect-container">
                    <input type="text" id="editSongMood" class="compact-input" placeholder="Search and select moods..." readonly>
                    <div class="multiselect-dropdown" id="editMoodDropdown">
                        <!-- Mood options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="editSelectedMoods"></div>
                </div>
                <label for="editSongTempo">Tempo (BPM):</label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input type="text" id="editSongTempo" placeholder="e.g., 80 BPM">
                    <button type="button" id="editTapTempoBtn" class="tap-tempo-btn">Tap Tempo</button>
                </div>
                <label for="editSongTime">Time Signature:</label>
                <select id="editSongTime" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="editSongTaal">Taal:</label>
                <select id="editSongTaal" required>
  <!-- Options will be populated by JS -->
                </select>
                <label for="editSongGenre">Genre:</label>
                <div class="multiselect-container">
                    <input type="text" id="editSongGenre" class="compact-input" placeholder="Search genres...">
                    <div class="multiselect-dropdown" id="editGenreDropdown">
                        <!-- Genre options will be rendered dynamically by JS -->
                    </div>
                    <div class="multiselect-selected" id="editSelectedGenres"></div>
                </div>
                <label for="editSongLyrics">Lyrics:</label>
                <textarea id="editSongLyrics" required></textarea>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <div class="modal" id="deleteSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Confirm Deletion</h3>
            <form id="deleteSongForm" class="delete-song-form">
                <input type="hidden" id="deleteSongId">
                <p id="deleteSongMessage">Are you sure you want to delete "<span id="deleteSongTitle"></span>"?</p>
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn btn-cancel" id="cancelDeleteSong">Cancel</button>
                    <button type="submit" class="btn btn-delete">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="confirmDeleteAllModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Confirm Delete All Songs</h3>
            <div class="delete-song-form">
                <p>Are you sure you want to delete ALL songs? This cannot be undone.</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-cancel" id="cancelDeleteAll">Cancel</button>
                    <button class="btn btn-delete" id="confirmDeleteAll">Delete All</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('settingsModal').style.display='none'">×</span>
            <h3>Settings</h3>
            <form id="settingsForm">
                <div class="settings-grid">
                    <div class="settings-group" style="display: none;">
                        <label for="sidebarHeaderInput">Sidebar Header:</label>
                        <input type="text" id="sidebarHeaderInput" >
                    </div>
                    <div class="settings-group" style="display: none;">
                        <label for="setlistTextInput">Setlist Menu Text:</label>
                        <input type="text" id="setlistTextInput" >
                    </div>
                    <div class="settings-group">
                        <label for="sessionResetOption">Session Reset:</label>
                        <select id="sessionResetOption">
                            <option value="manual">Manual (default)</option>
                            <option value="onClose">Reset on window close</option>
                            <option value="onRefresh">Reset on page refresh</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label for="panelWidthInput">Panel Width (%):</label>
                        <select id="panelWidthInput">
                            <option value="20">20%</option>
                            <option value="40">40%</option>
                            <option value="60">60%</option>
                            <option value="80">80%</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label for="previewMarginInput">Preview Margin Left (px):</label>
                        <input type="number" id="previewMarginInput" min="0" max="100" value="5">
                    </div>
                    <div class="settings-group">
                        <label for="autoScrollSpeedInput">Auto Scroll Speed:</label>
                        <select id="autoScrollSpeedInput">
                            <option value="2000">Slow</option>
                            <option value="1500" selected>Medium</option>
                            <option value="1000">Fast</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Settings</button>
            </form>
        </div>
    </div>

    <!-- Global Setlist Modal -->
    <div class="modal" id="globalSetlistModal">
        <div class="modal-content setlist-modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3 id="globalSetlistModalTitle">Create Global Setlist</h3>
            <form id="globalSetlistForm" class="setlist-form">
                <input type="hidden" id="globalSetlistId">
                <label for="globalSetlistName">Setlist Name:</label>
                <input type="text" id="globalSetlistName" required placeholder="Enter setlist name">
                <label for="globalSetlistDescription">Description (optional):</label>
                <textarea id="globalSetlistDescription" placeholder="Enter setlist description"></textarea>
                
                <div class="song-selection-section">
                    <label>Select Songs:</label>
                    
                    <!-- Search and Filters -->
                    <div class="modal-filters-container">
                        <div class="song-search-container">
                            <input type="text" id="globalSetlistSongSearch" placeholder="Search songs..." class="song-search-input">
                        </div>
                        <div class="modal-filters-row">
                            <select id="globalKeyFilter" class="compact-select">
                                <option value="">Keys</option>
                            </select>
                            <select id="globalGenreFilter" class="compact-select">
                                <option value="">Genres</option>
                            </select>
                            <select id="globalMoodFilter" class="compact-select">
                                <option value="">Moods</option>
                            </select>
                            <select id="globalArtistFilter" class="compact-select">
                                <option value="">Artists</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Tabs for Old/New Songs -->
                    <div class="modal-song-tabs">
                        <div class="modal-tab active" id="globalOldSongsTab">Old Songs</div>
                        <div class="modal-tab" id="globalNewSongsTab">New Songs</div>
                    </div>
                    
                    <div class="song-selection-container">
                        <!-- Old Songs Tab Content -->
                        <div class="modal-tab-content active" id="globalOldSongsContent">
                            <div class="song-category-header">
                                <label class="select-all-label">
                                    <input type="checkbox" id="globalSelectAllOldSongs"> Select All Old Songs (<span id="globalOldSongsCount">0</span>)
                                </label>
                            </div>
                            <div id="globalOldSongSelectionList" class="song-selection-list modal-scrollable"></div>
                        </div>
                        
                        <!-- New Songs Tab Content -->
                        <div class="modal-tab-content" id="globalNewSongsContent">
                            <div class="song-category-header">
                                <label class="select-all-label">
                                    <input type="checkbox" id="globalSelectAllNewSongs"> Select All New Songs (<span id="globalNewSongsCount">0</span>)
                                </label>
                            </div>
                            <div id="globalNewSongSelectionList" class="song-selection-list modal-scrollable"></div>
                        </div>
                        
                        <!-- Selected Songs Summary with Tabs -->
                        <div class="selected-songs-summary">
                            <h4>Selected Songs: <span id="globalSelectedCount">0</span></h4>
                            
                            <!-- Tabs for Selected Old/New Songs -->
                            <div class="modal-song-tabs">
                                <div class="modal-tab active" id="globalSelectedOldTab">Old Songs (<span id="globalSelectedOldCount">0</span>)</div>
                                <div class="modal-tab" id="globalSelectedNewTab">New Songs (<span id="globalSelectedNewCount">0</span>)</div>
                            </div>
                            
                            <div class="selected-songs-container">
                                <!-- Selected Old Songs Tab Content -->
                                <div class="modal-tab-content active" id="globalSelectedOldContent">
                                    <div id="globalSelectedOldSongsList" class="selected-songs-list modal-scrollable-summary"></div>
                                </div>
                                
                                <!-- Selected New Songs Tab Content -->
                                <div class="modal-tab-content" id="globalSelectedNewContent">
                                    <div id="globalSelectedNewSongsList" class="selected-songs-list modal-scrollable-summary"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="globalSetlistSubmit">Create Setlist</button>
            </form>
        </div>
    </div>

    <!-- My Setlist Modal -->
    <div class="modal" id="mySetlistModal">
        <div class="modal-content setlist-modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3 id="mySetlistModalTitle">Create My Setlist</h3>
            <form id="mySetlistForm" class="setlist-form">
                <input type="hidden" id="mySetlistId">
                <label for="mySetlistName">Setlist Name:</label>
                <input type="text" id="mySetlistName" required placeholder="Enter setlist name">
                <label for="mySetlistDescription">Description (optional):</label>
                <textarea id="mySetlistDescription" placeholder="Enter setlist description"></textarea>
                
                <div class="song-selection-section">
                    <label>Select Songs:</label>
                    
                    <!-- Search and Filters -->
                    <div class="modal-filters-container">
                        <div class="song-search-container">
                            <input type="text" id="mySetlistSongSearch" placeholder="Search songs..." class="song-search-input">
                        </div>
                        <div class="modal-filters-row">
                            <select id="myKeyFilter" class="compact-select">
                                <option value="">Keys</option>
                            </select>
                            <select id="myGenreFilter" class="compact-select">
                                <option value="">Genres</option>
                            </select>
                            <select id="myMoodFilter" class="compact-select">
                                <option value="">Moods</option>
                            </select>
                            <select id="myArtistFilter" class="compact-select">
                                <option value="">Artists</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Tabs for Old/New Songs -->
                    <div class="modal-song-tabs">
                        <div class="modal-tab active" id="myOldSongsTab">Old Songs</div>
                        <div class="modal-tab" id="myNewSongsTab">New Songs</div>
                    </div>
                    
                    <div class="song-selection-container">
                        <!-- Old Songs Tab Content -->
                        <div class="modal-tab-content active" id="myOldSongsContent">
                            <div class="song-category-header">
                                <label class="select-all-label">
                                    <input type="checkbox" id="mySelectAllOldSongs"> Select All Old Songs (<span id="myOldSongsCount">0</span>)
                                </label>
                            </div>
                            <div id="myOldSongSelectionList" class="song-selection-list modal-scrollable"></div>
                        </div>
                        
                        <!-- New Songs Tab Content -->
                        <div class="modal-tab-content" id="myNewSongsContent">
                            <div class="song-category-header">
                                <label class="select-all-label">
                                    <input type="checkbox" id="mySelectAllNewSongs"> Select All New Songs (<span id="myNewSongsCount">0</span>)
                                </label>
                            </div>
                            <div id="myNewSongSelectionList" class="song-selection-list modal-scrollable"></div>
                        </div>
                        
                        <!-- Selected Songs Summary with Tabs -->
                        <div class="selected-songs-summary">
                            <h4>Selected Songs: <span id="mySelectedCount">0</span></h4>
                            
                            <!-- Tabs for Selected Old/New Songs -->
                            <div class="modal-song-tabs">
                                <div class="modal-tab active" id="mySelectedOldTab">Old Songs (<span id="mySelectedOldCount">0</span>)</div>
                                <div class="modal-tab" id="mySelectedNewTab">New Songs (<span id="mySelectedNewCount">0</span>)</div>
                            </div>
                            
                            <div class="selected-songs-container">
                                <!-- Selected Old Songs Tab Content -->
                                <div class="modal-tab-content active" id="mySelectedOldContent">
                                    <div id="mySelectedOldSongsList" class="selected-songs-list modal-scrollable-summary"></div>
                                </div>
                                
                                <!-- Selected New Songs Tab Content -->
                                <div class="modal-tab-content" id="mySelectedNewContent">
                                    <div id="mySelectedNewSongsList" class="selected-songs-list modal-scrollable-summary"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="mySetlistSubmit">Create Setlist</button>
            </form>
        </div>
    </div>

    <!-- Setlist View Modal -->
    <div class="modal" id="setlistViewModal">
        <div class="modal-content setlist-view-content">
            <span class="close-modal" aria-label="Close">×</span>
            <div class="setlist-view-header">
                <h3 id="setlistViewTitle">Setlist</h3>
                <div class="setlist-view-actions">
                    <button id="editSetlistBtn" class="btn btn-secondary">Edit</button>
                    <button id="deleteSetlistBtn" class="btn btn-danger">Delete</button>
                </div>
            </div>
            <p id="setlistViewDescription"></p>
            <div class="setlist-tabs">
                <div class="setlist-tab active" id="setlistNewTab">New</div>
                <div class="setlist-tab" id="setlistOldTab">Old</div>
            </div>
            <div class="setlist-songs-content">
                <div id="setlistNewSongs" class="setlist-songs-view"></div>
                <div id="setlistOldSongs" class="setlist-songs-view" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Setlist Modal -->
    <div class="modal" id="confirmDeleteSetlistModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Confirm Delete Setlist</h3>
            <div class="delete-setlist-form">
                <p id="deleteSetlistMessage">Are you sure you want to delete this setlist?</p>
                <div class="modal-actions">
                    <button id="cancelDeleteSetlist" class="btn btn-secondary">Cancel</button>
                    <button id="confirmDeleteSetlist" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <!-- Suggested Songs Drawer -->
<div class="suggested-songs-drawer" id="suggestedSongsDrawer">
    <div class="suggested-songs-header">
        <h3>Suggested Songs</h3>
        <button class="close-suggested-songs" id="closeSuggestedSongs">&times;</button>
    </div>
    <div id="suggestedSongsContent"></div>
</div>

<button class="toggle-suggested-songs" id="toggleSuggestedSongs" title="Suggested Songs">
    <i class="fa fa-random"></i>
</button>
</body>
<script>
window.addEventListener('DOMContentLoaded', async () => {
    try {
        await init();
    } catch (e) {
        console.error('App failed to initialize:', e);
    }
});
</script>
</html>
